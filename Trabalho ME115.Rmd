---
title: "Trabalho ME115"
output:
  html_document:
    df_print: paged
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 
```{r}
### Importar bibliotecas
getwd()
setwd("C:\\Users\\dipis\\OneDrive\\Área de Trabalho\\Pastas\\R\\Trabalho R")


library(renv)
library(git2r)
library(ggplot2)
library(tidyr)
library(readr)
library(forcats)
library(dplyr)
```

```{r}
### Vai colar o repositório do github que está o trabalho do R

clone("https://github.com/diegopiresss/Trabalho---video_games_sales", "Trabalho R")
```

```{r}
df <- read_csv("C:\\Users\\dipis\\OneDrive\\Área de Trabalho\\Pastas\\R\\Trabalho R\\dados_games_a.csv")

df <- df %>% select(-img)

df

unique(df$console)    
unique(df$genre)    
unique(df$publisher)    
unique(df$developer)



```


```{r}
### Começando a fazer uma limpeza básica, removendo os consoles que tem menos do que 200 jogos

df <- df %>% filter(!console %in% c("SCD", "3D0", "GG", "MS", "PCE", "WW", "2600", "DC", "VC", "GC", "OSX", "And", "All","DSiW"))

df_filtrado <- df %>%
  group_by(console) %>%
  filter(n() >= 200) %>%
  ungroup()

df_filtrado

ggplot(df_filtrado, aes(x = fct_infreq(console))) +
  geom_bar(width = 0.5, color = 'lightblue', fill = 'lightblue') +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(x = "Consoles", y = "Quantidade de jogos", title = "Quantidade de jogos por plataforma")
```
```{r}
## Gráfico para saber quais foram os 20 jogos mais vendidos

df_resumido <- df %>%
  group_by(title) %>%
  summarise(
    total_sales = sum(total_sales, na.rm = TRUE),
    publisher = first(publisher)
  ) %>%
  arrange(desc(total_sales))

## Filtrar os jogos por colunas

df %>% filter(title == "Grand Theft Auto V")

top20jogos <- df %>% group_by(title) %>%  summarise(total_vendas_titulo = sum(total_sales, na.rm = TRUE)) %>% arrange(desc(total_vendas_titulo)) %>% head(20)

top20jogos

top20jogos$title <- factor(top20jogos$title, levels = top20jogos$title)

ggplot(data = top20jogos, aes(x= title, y = total_vendas_titulo)) +
  geom_col() +
  labs(title = '20 Jogos mais vendidos', x = 'Título', y = 'Vendas (em milhões)') +
  coord_flip() +
  theme_minimal()

```

Fazer uma análise dos principais títulos e franquias

```{r}
ggplot(df, aes(x = fct_infreq(console))) +
  geom_bar(width = 0.5, color = 'blue', fill = 'blue') +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(x = "Consoles", y = "Quantidade de jogos", title = "Quantidade de jogos por plataforma")
```
```{r}
### Começando a fazer um gráfico de vendas por cada video-game - para focarmos as análises somente para os videogmes que são mais relevantes
df_plataforma <- df %>% 
  group_by(Platform) %>% 
  summarise(Total_sales = sum(Global_Sales)) %>% 
  arrange(desc(Total_sales))

ggplot(df_plataforma, aes(x = reorder(Platform, -Total_sales), y = Total_sales)) +
  geom_col(fill = 'blue') +
  labs(
    x = "Videogame",
    y = "Vendas Totais (em milhões)",
    title = "Vendas Totais por Videogame"
  ) +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

```{r}
### Dropando todos os consoles que tem vendas muito baixas ou, são muito antigos e poucos conhecidos e relevanes para o mercado de games (essa remoção foi feita tando pela baixa de vendas e pelo conhecimento empírico do grupo sobre video games para dizer que essse consoles não são tão importantes nem relevantes para essa análise.)

df <- df %>% filter(!Platform %in% c("2600", "PSV", "DC", "SCD", "NG", "WS", "TG16", "3DO", "GG", "PCFX", "GEN"))

df_plataforma <- df %>% 
  group_by(Platform) %>% 
  summarise(Total_sales = sum(Global_Sales)) %>% 
  arrange(desc(Total_sales))

ggplot(df_plataforma, aes(x = reorder(Platform, -Total_sales), y = Total_sales)) +
  geom_col(fill = 'blue') +
  labs(
    x = "Videogame",
    y = "Vendas Totais (em milhões)",
    title = "Vendas Totais por Videogame"
  ) +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
```{r}
### Separando o dataset por gênero de jogos

df %>% 
  count(Genre) %>% 
  ggplot(aes(x = Genre, y = n)) +   
  geom_col(fill = "steelblue") +    
  labs(title = "Quantidade de jogos por gênero",
       x = "Gênero",
       y = "Quantidade de jogos") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))


```


```{r}
df
ggplot(data = df, 
       mapping = aes(x = Year, y = Global_Sales)) +
  geom_boxplot(size = 3)

ggplot(df, aes(Platform == "Wii", Total_sales)) +
  geom_point() +
  geom_line()
```
```{r}
df %>% 
  filter(Platform == "Wii") %>% 
  count(Genre) %>% 
  arrange(desc(n)) %>% 
  mutate(Genre = factor(Genre, levels = Genre)) %>% 
  ggplot(aes(x = Genre, y = n)) +
  geom_bar(stat = "identity") +
  labs(title = "Quantidade de Jogos por Gênero no Wii",
       x = "Gênero", y = "Quantidade") +
  coord_flip() +
  theme_minimal()

```


